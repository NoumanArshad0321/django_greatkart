{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Color circle acts as clickable radio */
    .color-circle {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #ccc;
        transition: transform 0.2s ease, border-color 0.2s ease;
    }
    .color-circle:hover {
        transform: scale(1.15);
        border-color: #000;
    }
    .color-circle.selected {
        border: 2px solid #000;
    }

    /* Thumbnails */
    .gallery-thumbs img {
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s ease;
    }
    .gallery-thumbs img:hover {
        border-color: #000;
    }
</style>

<section class="section-content padding-y bg">
    <div class="container">
        <div class="row">
            <!-- PRODUCT IMAGES -->
            <aside class="col-md-6">
                <div class="card">
                    <article class="gallery-wrap">
                        <!-- MAIN IMAGE -->
                        <div class="img-big-wrap">
                            <img class="main-product-image" src="{{ single_product.image.url }}" alt="{{ single_product.product_name }}">
                        </div>

                        <!-- ONLY VARIATION IMAGES IN THUMBS -->
                        <div class="thumbs-wrap gallery-thumbs d-flex gap-2 mt-2">
                            {% for variation in single_product.variation_set.all %}
                                {% if variation.image %}
                                <img src="{{ variation.image.url }}" width="60" height="60" alt="{{ variation.variation_value }}">
                                {% endif %}
                            {% endfor %}
                        </div>
                    </article>
                </div>
            </aside>

            <!-- PRODUCT DETAILS -->
            <main class="col-md-6">
                <form action="{% url 'add_cart' single_product.id %}" method="POST">
                    {% csrf_token %}
                    <article class="product-info-aside">
                        <h2 class="title mt-3">{{ single_product.product_name }}</h2>
                        <div class="mb-3">
                            <var class="price h4">${{ single_product.price }}</var>
                        </div>
                        <p>{{ single_product.description }}</p>

                        <!-- COLOR OPTIONS -->
                        <div class="row mb-3">
                            <div class="item-option-select">
                                <h6>Choose Color</h6>
                                <div class="d-flex gap-2 flex-wrap">
                                    {% for i in single_product.variation_set.colors %}
                                    <span class="color-circle" 
                                          style="background-color: {{ i.variation_value|lower }};" 
                                          data-color="{{ i.variation_value|lower }}" 
                                          data-image="{{ i.image.url }}"
                                          title="{{ i.variation_value }}">
                                    </span>
                                    {% endfor %}
                                </div>
                                <input type="hidden" name="color" id="selectedColor" required>
                            </div>
                        </div>

                        <!-- SIZE OPTIONS -->
                        <div class="row mb-3">
                            <div class="item-option-select">
                                <h6>Select Size</h6>
                                <div class="btn-group btn-group-sm btn-group-toggle" data-toggle="buttons">
                                    {% for i in single_product.variation_set.sizes %}
                                    <label class="btn btn-light">
                                        <input type="radio" name="size" value="{{ i.variation_value|lower }}" required> 
                                        {{ i.variation_value }}
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- ADD TO CART -->
                        <button type="submit" class="btn btn-primary">
                            <span class="text">Add to cart</span> <i class="fas fa-shopping-cart"></i>
                        </button>
                    </article>
                </form>
            </main>
        </div>
    </div>
                       <form action="{% url 'submit_review' single_product.id %}" method="POST">
                            {% csrf_token %}
                            <h5>Write Your Review</h5>
                            <div>

                                <label>How do you rate this product?</label>
                                <br>
                                <div class="rate">
                                    <input type="radio" name="rating" id="rating10" value="5" ><label for="rating10" title="5"></label>
                                    <input type="radio" name="rating" id="rating9" value="4.5" ><label for="rating9" title="4.5" class="half"></label>
                                    <input type="radio" name="rating" id="rating8" value="4" ><label for="rating8" title="4"></label>
                                    <input type="radio" name="rating" id="rating7" value="3.5"><label for="rating7" title="3.5" class="half"></label>
                                    <input type="radio" name="rating" id="rating6" value="3" ><label for="rating6" title="3"></label>
                                    <input type="radio" name="rating" id="rating5" value="2.5" ><label for="rating5" title="2.5" class="half"></label>
                                    <input type="radio" name="rating" id="rating4" value="2" ><label for="rating4" title="2"></label>
                                    <input type="radio" name="rating" id="rating3" value="1.5" ><label for="rating3" title="1.5" class="half"></label>
                                    <input type="radio" name="rating" id="rating2" value="1" ><label for="rating2" title="1"></label>
                                    <input type="radio" name="rating" id="rating1" value="0.5" required><label for="rating1" title="0.5" class="half"></label>
                                </div>
                                <br>

                                Review Title:
                                <input type="text" name="subject" class="form-control">
                                <br>
                                Your Review:
                                <textarea name="review" class="form-control" rows="5"></textarea>
                                <br>
                                {% if user.is_authenticated %}
                                  {% if orderproduct %}
                                <input type="submit" value="Submit Review" class="btn btn-primary">
                                  {% else %}
                                <p>You must purchase this product before you can review it.</p>
                                  {% endif %}
                                {% endif %}
                            </div>
                            {% include 'includes/alerts.html' %}
                        </form>
                        <br>
                        
<div class="row">
			<div class="col-md-9">

	<header class="section-heading">
		<h3>Customer Reviews </h3>  
		
	</header>
			<img src="{% static 'images/avatars/avatar1.jpg' %}" class="img-xs icon rounded-circle">

	<article class="box mb-3">
		<div class="icontext w-100">
			<div class="text">
				<span class="date text-muted float-md-right">24.04.2020 </span>  
				<h6 class="mb-1">Mike John </h6>
				
			</div>
		</div> <!-- icontext.// -->
		<div class="mt-3">
			<p>
				Dummy comment Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
				tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
				quis nostrud exercitation ullamco laboris nisi ut aliquip
			</p>	
		</div>
	</article>

	

	</div> <!-- col.// -->
</section>

<!-- JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const colorCircles = document.querySelectorAll('.color-circle');
    const selectedColorInput = document.getElementById('selectedColor');
    const mainImage = document.querySelector('.main-product-image');
    const thumbs = document.querySelectorAll('.gallery-thumbs img');

    // Select color by clicking circle
    colorCircles.forEach(circle => {
        circle.addEventListener('click', function() {
            // remove old selection
            colorCircles.forEach(c => c.classList.remove('selected'));
            // mark new
            this.classList.add('selected');
            // set hidden input
            selectedColorInput.value = this.getAttribute('data-color');
            // switch main image
            const newImage = this.getAttribute('data-image');
            if (newImage) {
                mainImage.src = newImage;
            }
        });
    });

    // Switch when thumbnail clicked
    thumbs.forEach(thumb => {
        thumb.addEventListener('click', function() {
            mainImage.src = this.src;
        });
    });
});
</script>
{% endblock %}