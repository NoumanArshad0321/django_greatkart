{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Color circle acts as clickable radio */
    .color-circle {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #ccc;
        transition: transform 0.2s ease, border-color 0.2s ease;
    }
    .color-circle:hover {
        transform: scale(1.15);
        border-color: #000;
    }
    .color-circle.selected {
        border: 2px solid #000;
    }

    /* Thumbnails */
    .gallery-thumbs img {
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s ease;
    }
    .gallery-thumbs img:hover {
        border-color: #000;
    }
</style>

<section class="section-content padding-y bg">
    <div class="container">
        <div class="row">
            <!-- PRODUCT IMAGES -->
            <aside class="col-md-6">
                <div class="card">
                    <article class="gallery-wrap">
                        <!-- MAIN IMAGE -->
                        <div class="img-big-wrap">
                            <img class="main-product-image" src="{{ single_product.image.url }}" alt="{{ single_product.product_name }}">
                        </div>

                        <!-- ONLY VARIATION IMAGES IN THUMBS -->
                        <div class="thumbs-wrap gallery-thumbs d-flex gap-2 mt-2">
                            {% for variation in single_product.variation_set.all %}
                                {% if variation.image %}
                                <img src="{{ variation.image.url }}" width="60" height="60" alt="{{ variation.variation_value }}">
                                {% endif %}
                            {% endfor %}
                        </div>
                    </article>
                </div>
            </aside>

            <!-- PRODUCT DETAILS -->
            <main class="col-md-6">
                <form action="{% url 'add_cart' single_product.id %}" method="POST">
                    {% csrf_token %}
                    <article class="product-info-aside">
                        <h2 class="title mt-3">{{ single_product.product_name }}</h2>
                        <div class="mb-3">
                            <var class="price h4">${{ single_product.price }}</var>
                        </div>
                        <p>{{ single_product.description }}</p>

                        <!-- COLOR OPTIONS -->
                        <div class="row mb-3">
                            <div class="item-option-select">
                                <h6>Choose Color</h6>
                                <div class="d-flex gap-2 flex-wrap">
                                    {% for i in single_product.variation_set.colors %}
                                    <span class="color-circle" 
                                          style="background-color: {{ i.variation_value|lower }};" 
                                          data-color="{{ i.variation_value|lower }}" 
                                          data-image="{{ i.image.url }}"
                                          title="{{ i.variation_value }}">
                                    </span>
                                    {% endfor %}
                                </div>
                                <input type="hidden" name="color" id="selectedColor" required>
                            </div>
                        </div>

                        <!-- SIZE OPTIONS -->
                        <div class="row mb-3">
                            <div class="item-option-select">
                                <h6>Select Size</h6>
                                <div class="btn-group btn-group-sm btn-group-toggle" data-toggle="buttons">
                                    {% for i in single_product.variation_set.sizes %}
                                    <label class="btn btn-light">
                                        <input type="radio" name="size" value="{{ i.variation_value|lower }}" required> 
                                        {{ i.variation_value }}
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- ADD TO CART -->
                        <button type="submit" class="btn btn-primary">
                            <span class="text">Add to cart</span> <i class="fas fa-shopping-cart"></i>
                        </button>
                    </article>
                </form>
            </main>
        </div>
    </div>
</section>

<!-- JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const colorCircles = document.querySelectorAll('.color-circle');
    const selectedColorInput = document.getElementById('selectedColor');
    const mainImage = document.querySelector('.main-product-image');
    const thumbs = document.querySelectorAll('.gallery-thumbs img');

    // Select color by clicking circle
    colorCircles.forEach(circle => {
        circle.addEventListener('click', function() {
            // remove old selection
            colorCircles.forEach(c => c.classList.remove('selected'));
            // mark new
            this.classList.add('selected');
            // set hidden input
            selectedColorInput.value = this.getAttribute('data-color');
            // switch main image
            const newImage = this.getAttribute('data-image');
            if (newImage) {
                mainImage.src = newImage;
            }
        });
    });

    // Switch when thumbnail clicked
    thumbs.forEach(thumb => {
        thumb.addEventListener('click', function() {
            mainImage.src = this.src;
        });
    });
});
</script>
{% endblock %}
